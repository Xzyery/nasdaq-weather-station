name: Update FRED Data (OSS Backup)

# 这是备用方案：将数据上传到阿里云 OSS
# 如果不使用此方案，可以删除此文件

on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        cd backend
        pip install pandas-datareader sqlalchemy requests
        
    - name: Run data fetcher
      run: |
        cd backend
        python standalone_fetcher.py
        
    - name: Upload to Aliyun OSS
      if: success()
      uses: tvrcgo/upload-to-oss@master
      with:
        key-id: ${{ secrets.OSS_KEY_ID }}
        key-secret: ${{ secrets.OSS_KEY_SECRET }}
        region: oss-cn-shanghai
        bucket: nasdaq-weather-data
        assets: |
          backend/macro_weather_v3.db:data/latest.db
